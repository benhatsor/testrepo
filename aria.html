<script>

function init() {

  const peopleWrapper = document.querySelector('.people-wrapper');

  const buttons = document.querySelectorAll('.wsite-button');
  
  let addButton, confirmButton;
  
  
  const prefix = 'https://example.com/';
  
  buttons.forEach(button => {
    
    if (button.href === (prefix + 'add')) {
      
      button.href = '#';
      
      addButton = button;
      
    }
    
    if (button.href === (prefix + 'confirm')) {
      
      button.href = '#';
      
      confirmButton = button;
      
    }
    
  });
  
  
  addButton.classList.add('add-button');
  addButton.children[0].innerHTML = addIcon;
  

  peopleWrapper.innerHTML = personGroup;

  addButton.addEventListener('click', () => {
    
    peopleWrapper.appendChild(fragmentFromString(personGroup));
    
  });
  
  
  confirmButton.addEventListener('click', () => {
    
    const peopleEl = peopleWrapper.querySelectorAll('.person');
    
    
    const peopleData = getPeopleData(peopleEl);
    
    if (!peopleData) {
      
        alert(invalidFormValuesStr);
        
        return;
        
    }
    
    
    const peopleDataStr = JSON.stringify(peopleData);
    
    localStorage.setItem('people', peopleDataStr);
    
    window.location.href = '/results';
    
  });
  
  
  
  document.querySelector('#weebly-footer-signup-container-v3').remove();

}


function getPeopleData(peopleEl) {
  
  let people = [];
  
  for (let i = 0; i < peopleEl.length; i++) {
    
    const person = peopleEl[i];
    
    const age = person.querySelector('#age').value;
    const sex = person.querySelector('#sex').value;
    
    if (age !== '' && sex !== '') {
      
      people.push({ age, sex });
      
    } else {
            
      return;
      
    }
    
  }
  
  return people;
  
}



const addIcon = '<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px" fill="currentColor"><path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"></path></svg>';

const personGroup = `<div class="person">
  <div class="wsite-form-field wsite-name-field">
    <div style="clear:both;"></div>
    <div class="wsite-form-radio-container wsite-form-left wsite-form-input-first-name">
      <select id="sex" class="form-select">
        <option value="">מין</option>
        <hr>
        <option value="f">נקבה</option>
        <option value="m">זכר</option>
      </select>
    </div>
    <div class="wsite-form-input-container wsite-form-right wsite-form-input-last-name">
      <input class="wsite-form-input wsite-input" placeholder="גיל" type="number" id="age" min="0">
    </div>
  </div>
  <div style="clear:both;"></div>
</div>`;

const invalidFormValuesStr = 'לא מילאת את כל הטופס.';


function fragmentFromString(strHTML) {
    const temp = document.createElement('template');
    temp.innerHTML = strHTML;
    return temp.content;
}


window.addEventListener('load', init);

</script>



<style>
.people-wrapper .person {
    background: rgba(0, 0, 0, 0.1);
    padding: 20px;
    padding-bottom: 10px;
    margin: 10px 0;
}

.form-select {
    background-position: 10% !important;
}

.wsite-form-input {
    height: 40px;
}

.add-button .wsite-button-inner {
  display: flex;
  padding: 8px;
  transition-property: color, background;
}


.cento-header .nav-wrap {
  display: none;
}

.footer-wrap {
  display: none;
}
</style>

